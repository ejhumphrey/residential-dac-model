---
import CarbonCalculator from '../components/CarbonCalculator.jsx';
import SorbentCapture from '../components/SorbentCapture.jsx';
---

<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Hub & Spoke Carbon Model</title>
    <style>
        :root {
            --slate-100: #f1f5f9;
            --slate-200: #e2e8f0;
            --slate-500: #64748b;
            --slate-700: #334155;
            --slate-800: #1e293b;
            --sky-500: #0ea5e9;
        }
        body {
            font-family: system-ui, sans-serif;
            background-color: var(--slate-100);
            color: var(--slate-800);
            margin: 0;
            padding: 2rem;
        }
        /* The main content area, initially hidden */
        main {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
            max-width: 1200px;
            margin: auto;
            visibility: hidden; /* Hide content until password is entered */
        }
        @media (min-width: 900px) {
            main {
                grid-template-columns: 450px 1fr;
            }
        }
        h1 { font-size: 2.5rem; }
        p { color: var(--slate-500); margin-top: 0; }
        .header { grid-column: 1 / -1; }

        /* Styles for the password prompt overlay */
        #login-prompt {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(240, 240, 240, 0.95);
            display: grid; place-content: center; z-index: 1000;
        }
        #login-prompt form {
            display: flex; flex-direction: column; gap: 1rem;
            padding: 2rem; background: white; border: 1px solid #ccc; border-radius: 8px;
        }
        .error { color: red; font-size: 0.9rem; }
    </style>
</head>
<body>
    <div id="login-prompt">
        <form id="login-form">
            <h2>Enter Password</h2>
            <input type="password" id="password-input" required />
            <button type="submit">Unlock</button>
            <p id="error-message" class="error" style="display:none;">Invalid password.</p>
        </form>
    </div>

    <main id="content">
        <div class="header">
            <h1>Hub & Spoke Carbon Model</h1>
            <p>An interactive calculator to model the carbon efficiency of a decentralized DAC transport network.</p>
        </div>
        
        <CarbonCalculator client:load />
        <SorbentCapture client:load />
    </main>

    <script>
        // --- PASTE YOUR GENERATED HASH AND SALT HERE ---
        const SALT = "11643a095ebba259c7676f2c50cdd35c";
        const HASH = "8b5e8eda4d527ffef9ea41714c5a12f34032833810ef40992701c16f30aaf8e3";
        // ---------------------------------------------

        const content = document.getElementById('content');
        const loginPrompt = document.getElementById('login-prompt');
        const loginForm = document.getElementById('login-form');
        const passwordInput = document.getElementById('password-input');
        const errorMessage = document.getElementById('error-message');

        function hexToBytes(hex) {
            const bytes = new Uint8Array(hex.length / 2);
            for (let i = 0; i < hex.length; i += 2) {
                bytes[i / 2] = parseInt(hex.substring(i, i + 2), 16);
            }
            return bytes;
        }

        async function verifyPassword(password) {
            if (!password || SALT.includes("PASTE") || HASH.includes("PASTE")) return false;
            try {
                const saltBytes = hexToBytes(SALT);
                const encoder = new TextEncoder();
                const keyMaterial = await window.crypto.subtle.importKey(
                    'raw', encoder.encode(password), { name: 'PBKDF2' }, false, ['deriveBits']
                );
                const key = await window.crypto.subtle.deriveBits(
                    { "name": "PBKDF2", "salt": saltBytes, "iterations": 100000, "hash": "SHA-256" },
                    keyMaterial, 256
                );
                const hashHex = Array.from(new Uint8Array(key)).map(b => b.toString(16).padStart(2, '0')).join('');
                return hashHex === HASH;
            } catch (e) { return false; }
        }

        function showContent() {
            loginPrompt.style.display = 'none';
            content.style.visibility = 'visible';
        }

        document.addEventListener('DOMContentLoaded', () => {
            if (sessionStorage.getItem('isLoggedIn') === 'true') {
                showContent();
            } else {
                loginPrompt.style.display = 'grid';
            }
        });

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const isCorrect = await verifyPassword(passwordInput.value);
            if (isCorrect) {
                sessionStorage.setItem('isLoggedIn', 'true');
                showContent();
            } else {
                errorMessage.style.display = 'block';
            }
        });
    </script>
</body>
</html>
